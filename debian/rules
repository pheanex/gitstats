#!/usr/bin/make -f

TMPDIR = tmp-debian-build
VERSION =  $(shell dpkg-parsechangelog | egrep '^Version' | \
        sed -r 's/Version:\s*//' | sed -r 's/^[0-9]+://' | \
        sed -r 's/(\.dfsg)?-[0-9.]+//')


build:
	mkdir -p $(TMPDIR)
	cat gitstats | perl -p -e 's/VERSION = 0/VERSION = "$(VERSION)"/' > $(TMPDIR)/gitstats
	$(MAKE) man

clean:
	rm -rf $(TMPDIR)
	rm -f doc/gitstats.1
	dh_testdir
	dh_clean 

install: build
	dh_testdir
	dh_testroot
	dh_clean -k 
	dh_install

binary-arch:
binary-indep: build install
	dh_testdir
	dh_testroot
	dh_installchangelogs 
	dh_installdocs
	dh_installman
	dh_compress
	dh_fixperms
	dh_installdeb
	dh_gencontrol
	dh_md5sums
	dh_builddeb

binary: binary-indep binary-arch
.PHONY: build clean binary-indep binary-arch binary install
